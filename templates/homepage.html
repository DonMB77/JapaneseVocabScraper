{% extends 'base.html' %}

{% block head %}
<link rel="stylesheet" href="../static/style.css">
{% endblock %}

{% block body %}
{% if words|length == 0 %}
<div class="input-group mb-3">
    <form action="/" method="POST">
        <input type="text" name="url" class="form-control" placeholder="Input URL" aria-label="Recipient's username"
            aria-describedby="button-addon2">
        <button class="btn btn-outline-secondary" type="submit" id="button-addon2">Submit</button>
    </form>
</div>
{% endif %}
<div>
    <h1>Fetched Vocabulary</h1>
    {% if words|length > 0 %}
    <table class="table table-bordered">
        <tr>
            <td>Reading</td>
            <td>Furigana</td>
            <td>Word Type</td>
            <td>Translation</td>
            <td>Details</td>
            <td>Save Button</td>
        </tr>
        {% for item in words %}
        <tr>
            <td>{{ item.readingJapanese }}</td>
            <td>{{ item.furigana }}</td>
            <td>{{ item.wordType }}</td>
            <td>{{ item.translation }}</td>
            <td>
                <button type="button" class="btn btn-info btn-sm" onclick="showPopup('popup-{{ loop.index0 }}')">Details</button>
                <div id="popup-{{ loop.index0 }}" class="custom-popup" style="display:none;">
                    <div class="custom-popup-content">
                        <span class="close-btn" onclick="hidePopup('popup-{{ loop.index0 }}')">&times;</span>
                        <h5>Word Details</h5>
                        <div class="d-flex flex-row mb-2 gap-3">
                            <div>{{ item.readingJapanese }}</div>
                            <div>{{ item.furigana }}</div>
                            <div>{{ item.wordType }}</div>
                        </div>
                        <div>
                            {{ item.translation }}
                        </div>
                    </div>
                </div>
            </td>
            <td>
                <form method="post" action="/save_vocab" style="display:inline;">
                    <input type="hidden" name="readingJapanese" value="{{ item.readingJapanese }}">
                    <input type="hidden" name="furigana" value="{{ item.furigana }}">
                    <input type="hidden" name="wordType" value="{{ item.wordType }}">
                    <input type="hidden" name="translation" value="{{ item.translation }}">
                    <input type="hidden" name="page" value="{{ request.args.get('page', 0) }}">
                    <button type="submit" class="btn btn-success btn-sm">Save</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </table>
    <div class="d-flex justify-content-center my-3">
        <nav aria-label="Page navigation">
            <ul class="pagination flex-wrap">
                {% for num in page_numbers %}
                {% if num == page %}
                <li class="page-item active" aria-current="page">
                    <span class="page-link">{{ num + 1 }}</span>
                </li>
                {% else %}
                <li class="page-item">
                    <a class="page-link"
                        href="{{ url_for(request.endpoint, page=num, q=request.args.get('q', '')) }}">{{ num + 1 }}</a>
                </li>
                {% endif %}
                {% endfor %}
            </ul>
        </nav>
    </div>
    <form method="post" action="/clear" style="margin-top: 1em;">
        <button type="submit" class="btn btn-danger">New URL (clears all fetched)</button>
    </form>
    {% endif %}
</div>
<script>
function showPopup(id) {
    document.getElementById(id).style.display = 'flex';
}
function hidePopup(id) {
    document.getElementById(id).style.display = 'none';
}
</script>
{% endblock %}